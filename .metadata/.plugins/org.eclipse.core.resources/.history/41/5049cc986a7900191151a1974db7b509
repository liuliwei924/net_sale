package org.xxjr.job.listener.cust;

import org.ddq.common.constant.DuoduoConstant;
import org.ddq.common.context.AppParam;
import org.ddq.common.context.AppProperties;
import org.ddq.common.context.AppResult;
import org.ddq.common.util.LogerUtil;
import org.ddq.job.core.BaseExecteJob;
import org.ddq.job.util.JobConstant;
import org.ddq.job.util.JobUtil;
import org.ddq.common.core.service.RemoteInvoke;
import org.springframework.context.annotation.Lazy;
import org.springframework.stereotype.Component;
import org.xxjr.sys.util.ServiceKey;

/**
 * 每月 定时增加会员退款次数
 * @author Administrator
 *
 */
@Lazy
@Component
public class AutoAddVipRefundJob implements BaseExecteJob {

	@Override
	public AppResult executeJob(AppParam param) {
		LogerUtil.debug("AutoAddVipRefundJob start");
		Object processId = param.getAttr(JobConstant.KEY_processId);
		AppResult result = new AppResult();
		int size = 0;
		try {
			AppParam params = new AppParam();
			params.setService("vipFreeService");
			params.setMethod("addRefundCount");
			params.setRmiServiceName(AppProperties.
					getProperties(DuoduoConstant.RMI_SERVICE_START+ServiceKey.Key_cust));
			
			AppResult upadteResult = RemoteInvoke.getInstance().call(params);
			size = Integer.valueOf(upadteResult.getAttr(DuoduoConstant.DAO_Update_SIZE).toString());
		} catch (Exception e) {
			LogerUtil.error(AutoAddVipRefundJob.class, e, "AutoAddVipRefundJob error!");
			JobUtil.addProcessExecute(processId, "添加会员退款次数失败:" + e.getMessage());
		}
		LogerUtil.debug("AutoResetVipCount over");
		result.setMessage("添加会员退款次数成功！更改了"+size+"条记录");
		return result;
	}

}

