package org.xxjr.busi.util.novel;

import java.util.Collections;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;

import org.ddq.common.constant.DuoduoConstant;
import org.ddq.common.context.AppParam;
import org.ddq.common.context.AppProperties;
import org.ddq.common.context.AppResult;
import org.ddq.common.exception.ExceptionUtil;
import org.ddq.common.util.LogerUtil;
import org.ddq.common.web.session.DuoduoSession;
import org.ddq.zk.service.RemoteInvoke;
import org.springframework.util.StringUtils;
import org.xxjr.cust.util.info.CustInfoUtil;
import org.xxjr.sys.util.ServiceKey;

/**
 * 微站资讯
 * @author  gaosi
 * @version 201708070929
 */
public class WzNovelUtil {
	
	/**
	 * 获取资讯或个人文章信息
	 * @param  request
	 * @return AppResult
	 */
	public static AppResult getNovelInfo(HttpServletRequest request, String customerId){
		AppResult result = new AppResult();
		String novelId = request.getParameter("novelId");
		String articleId = request.getParameter("articleId");
		try {
			Object isShowAdvert = "1";
			Map<String, Object> novelInfo = Collections.emptyMap();
			if(!StringUtils.isEmpty(novelId)){
				//查询资讯信息
				AppParam params = new AppParam("zixunService","query");
				params.addAttr("novelId", novelId);
				params.setRmiServiceName(AppProperties
						.getProperties(DuoduoConstant.RMI_SERVICE_START + ServiceKey.Key_zx));
				AppResult novelResult = RemoteInvoke.getInstance().callNoTx(params);
				if(novelResult.getRows().size() > 0){
					novelInfo = novelResult.getRow(0);
				}
			}
			if(!StringUtils.isEmpty(articleId)){
				//查询资讯信息
				AppParam params = new AppParam("wzArticleService","query");
				params.addAttr("articleId", articleId);
				params.setRmiServiceName(AppProperties
						.getProperties(DuoduoConstant.RMI_SERVICE_START + ServiceKey.Key_zx));
				AppResult novelResult = RemoteInvoke.getInstance().callNoTx(params);
				if(novelResult.getRows().size() > 0){
					novelInfo = novelResult.getRow(0);
					isShowAdvert = novelResult.getAttr("isShowAdvert");
				}
			}
			if(!StringUtils.isEmpty(customerId) && CustInfoUtil.isWzVip(customerId)){
				isShowAdvert = "0";
			}
			result.putAttr("novelInfo", novelInfo);
			result.putAttr("isShowAdvert", isShowAdvert);
		} catch (Exception e) {
			LogerUtil.error(WzNovelUtil.class, e, "getNovelInfo");
			ExceptionUtil.setExceptionMessage(e, result, DuoduoSession.getShowLog());
		}
		return result;
	}
	
	/**
	 * 获取微站用户个人文章信息
	 * @param articleId
	 * @param customerId
	 * @return
	 */
	public static AppResult getArticleInfo(String articleId, String customerId){
		AppResult result = new AppResult();
		try {
			Object isShowAdvert = "1";
			Map<String, Object> novelInfo = Collections.emptyMap();
			if(!StringUtils.isEmpty(articleId)){
				//查询资讯信息
				AppParam params = new AppParam("wzArticleService","query");
				params.addAttr("articleId", articleId);
				params.setRmiServiceName(AppProperties
						.getProperties(DuoduoConstant.RMI_SERVICE_START + ServiceKey.Key_zx));
				AppResult novelResult = RemoteInvoke.getInstance().callNoTx(params);
				if(novelResult.getRows().size() > 0){
					novelInfo = novelResult.getRow(0);
					isShowAdvert = novelResult.getRow(0).get("isShowAdvert");
				}
			}
			if(CustInfoUtil.isWzVip(customerId)){
				isShowAdvert = "0";
			}
			result.putAttr("novelInfo", novelInfo);
			result.putAttr("isShowAdvert", isShowAdvert);
		} catch (Exception e) {
			LogerUtil.error(WzNovelUtil.class, e, "getNovelInfo");
			ExceptionUtil.setExceptionMessage(e, result, DuoduoSession.getShowLog());
		}
		return result;
	}
	
}
