package org.xxjr.busi.util;

import java.io.Serializable;
import java.util.HashMap;
import java.util.Map;

import org.ddq.common.constant.DuoduoConstant;
import org.ddq.common.context.AppParam;
import org.ddq.common.context.AppProperties;
import org.ddq.common.context.AppResult;
import org.ddq.common.core.service.RemoteInvoke;
import org.llw.model.cache.RedisUtils;
import org.springframework.util.StringUtils;
import org.xxjr.sys.util.ServiceKey;

public class AnimationCustUtils {

	/** 动画名片用户缓存  **/
	public final static String ANIMATION_CUST = "animation_cust";
	
	/***
	 * 获取动画名片用户信息
	 */
	@SuppressWarnings("unchecked")
	public static Map<String,Object> getAnimationCust(String custId,String gzhId){
		Map<String,Object> map = ((Map<String, Object>) RedisUtils.getRedisService().get(ANIMATION_CUST+custId+"_"+gzhId));
		if(map==null || map.isEmpty()){
			map = refershAnimationCust(custId,gzhId);
		}
		return map;
	}
	
	/***
	 * 刷新动画名片用户信息
	 */
	public static Map<String,Object> refershAnimationCust(String custId,String gzhId){
		AppParam param  = new AppParam();
		param.setService("animationCustomerService");
		param.setMethod("query");
		param.setRmiServiceName(AppProperties
				.getProperties(DuoduoConstant.RMI_SERVICE_START + ServiceKey.Key_zx));
		param.addAttr("customerId", custId);
		param.addAttr("gzhId", gzhId);
		AppResult result = RemoteInvoke.getInstance().callNoTx(param);
		Map<String,Object> custInfo = new HashMap<String,Object>();
		if(result.getRows().size() > 0){
			custInfo = result.getRow(0);
		}
		RedisUtils.getRedisService().set(ANIMATION_CUST+custId+"_"+gzhId, (Serializable)custInfo, 60*60*4);
		return custInfo;
	}
	
	/***
	 * 根据用户openid查客户信息
	 * @param openid
	 * @return
	 */
	public static Map<String, Object> queryInfoByOpenid(String openid){
		if(StringUtils.isEmpty(openid)){
			return null;
		} 
		AppParam param = new AppParam();
		param.addAttr("openId", openid);
		param.setService("animationCustomerService");
		param.setMethod("query");
		param.setRmiServiceName(AppProperties
				.getProperties(DuoduoConstant.RMI_SERVICE_START + ServiceKey.Key_zx));
		AppResult result = RemoteInvoke.getInstance().call(param);
		if(result.getRows().size() > 0){
			return result.getRow(0);
		}
		return null;
	}	

}
